{{ header }}
<main>
    <div class="container-fluid">
        <ul class="breadcrumb">
            {% for breadcrumb in breadcrumbs %}
                {% if loop.first %}
                    <li><a href="{{ breadcrumb.href }}"><img alt="Home"
                                                             src="catalog/view/theme/simplex/assets/img/home.svg"></a>
                    </li>
                {% else %}
                    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
                {% endif %}
            {% endfor %}
        </ul>
        <div class="page-title" id="wishlist">
            <h1>{{ heading_title }}</h1>
        </div>
        <div id="cart-wrapper">
            <a class="delete-all delete-all-from-cart" role="button">{{ delete_all }}</a>
            {% if attention %}
                <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ attention }}
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                </div>
            {% endif %}
            {% if success %}
                <div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                </div>
            {% endif %}
            {% if error_warning %}
                <div class="alert alert-danger alert-dismissible"><i
                            class="fa fa-exclamation-circle"></i> {{ error_warning }}
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                </div>
            {% endif %}
            <div class="cards">
                {{ content_top }}
            </div>
            <div class="cart-table">
                <table>
                    <thead>
                    <tr>
                        <th class="image">{{ column_image }}</th>
                        <th>{{ column_name }}</th>
                        <th class="price">{{ column_price }}</th>
                        <th class="multiply"></th>
                        <th class="quantity">{{ column_quantity }}</th>
                        <th class="equal"></th>
                        <th class="total">{{ column_total }}</th>
                        <th class="delete"></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for product in products %}
                        <tr>
                            <td class="image">{% if product.thumb %} <a href="{{ product.href }}"><img
                                            src="{{ product.thumb }}" alt="{{ product.name }}"
                                            title="{{ product.name }}"></a> {% endif %}</td>
                            <td>
                                <a href="{{ product.href }}">{{ product.name }}</a>
                                {% if product.option %}
                                    {% for option in product.option %} <br/>
                                        <small>{{ option.name }}: {{ option.value }}</small> {% endfor %}
                                {% endif %}
                            </td>
                            <td class="price">{{ product.price }}</td>
                            <td class="multiply"><span>x</span></td>
                            <td class="quantity"><label><input type="number" id="quantity"
                                                               name="quantity[{{ product.cart_id }}]"
                                                               value="{{ product.quantity }}" max="100" min="1" step="1"
                                                               size="1"></label></td>
                            <td class="equal"><span>=</span></td>
                            <td class="total">{{ product.total }}</td>
                            <td class="delete">
                                <a role="button" title="{{ button_remove }}"
                                   onclick="cart.remove('{{ product.cart_id }}');">
                                    <svg height="14px" width="18px" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M14.877,10.113 L2.076,1.000 " fill="none" fill-rule="evenodd"
                                              stroke="rgb(178, 181, 182)" stroke-linecap="butt" stroke-linejoin="miter"
                                              stroke-width="2px"></path>
                                        <path d="M2.076,10.113 L14.877,1.000 " fill="none" fill-rule="evenodd"
                                              stroke="rgb(178, 181, 182)" stroke-linecap="butt" stroke-linejoin="miter"
                                              stroke-width="2px"></path>
                                    </svg>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="6" style="text-align: right"><span>{{ totals[0].title }}:</span></td>
                        <td colspan="2"><h5 style="margin-bottom: 0;">{{ totals[0].text }}
                                <small style="font-size: .625rem;font-weight: 500;">MDL</small>
                            </h5></td>
                    </tr>
                    </tfoot>
                </table>
            </div>
            {% if modules %}
                <div class="panel panel-default">
                    {% for module in modules %}
                        {{ module }}
                    {% endfor %}
                </div>
            {% endif %}
            <div class="checkout">
                <div class="total">
                    <span>{{ total }}</span>
                    <div class="price">
                        <h5>
                            <small>MDL</small>
                        </h5>
                    </div>
                </div>
                <a href="{{ checkout }}" class="btn btn-primary">{{ button_checkout }}<span
                            class="image-container"></span></a>
            </div>
        </div>
    </div>
    <hr>
    {{ content_bottom }}
</main>
{{ footer }}
<script>
    $(document).ready(function () {
        $.ajax({
            url: 'index.php?route=extension/total/shipping/quote',
            type: 'post',
            data: 'country_id=' + 140 + '&zone_id=' + $('select[name=\'zone_id\']').val() + '&postcode=' + encodeURIComponent($('input[name=\'postcode\']').val()),
            dataType: 'json',
            beforeSend: function () {
                $('#button-quote').button('loading');
            },
            complete: function () {
                $('#button-quote').button('reset');
            },
            success: function (json) {
                $('.alert-dismissible, .text-danger').remove();
                if (json['error']) {
                    if (json['error']['warning']) {
                        $('.breadcrumb').after('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');

                        $('html, body').animate({scrollTop: 0}, 'slow');
                    }

                    if (json['error']['country']) {
                        $('select[name=\'country_id\']').addClass('has-error');
                    }

                    if (json['error']['zone']) {
                        $('select[name=\'zone_id\']').addClass('has-error');
                    }

                    if (json['error']['postcode']) {
                        $('input[name=\'postcode\']').addClass('has-error');
                    }
                }
                if (json['shipping_method']) {
                    for (i in json['shipping_method']) {
                        if (!json['shipping_method'][i]['error']) {
                            for (j in json['shipping_method'][i]['quote']) {
                                if (json['shipping_method'][i]['quote'][j]['code'] === $('input[name="shipping_method"]').val()) {
                                    $('.checkout .price h5').prepend(parseInt({{ totals[0].text }}) + parseInt(json['shipping_method'][i]['quote'][j]['cost']));
                                }
                            }
                        }
                    }


                    $('input[type="radio"]').after('<span class="radio"></span>');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
</script>